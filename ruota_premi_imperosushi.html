<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ruota della Fortuna - Impero Sushi</title>
  <style>
    body {
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #fff5f5, #ffe6cc);
    }
    .wrap {
      max-width:800px;
      width:100%;
      padding:20px;
      box-sizing:border-box;
      text-align:center;
    }
    h1 {
      margin:10px 0;
      font-size:24px;
      color:#b22222;
      font-weight:700;
    }
    .card {
      background:#fff;
      border-radius:18px;
      box-shadow:0 6px 24px rgba(0,0,0,0.1);
      padding:18px;
    }
    canvas {
      width:100%;
      max-width:560px;
      display:block;
      margin:0 auto;
    }
    button {
      margin-top:14px;
      padding:12px 22px;
      border-radius:12px;
      border:none;
      background:#b22222;
      color:white;
      font-weight:600;
      cursor:pointer;
      font-size:16px;
      transition: all 0.2s;
    }
    button:hover { background:#8b1a1a; }
    button:disabled {
      background:#ccc;
      cursor:not-allowed;
    }
    #resultCard {
      display:none;
      margin-top:20px;
      padding:20px;
      border-radius:16px;
      background:linear-gradient(145deg,#fff,#fff8e1);
      border:3px solid #ffd700;
      box-shadow:0 4px 20px rgba(0,0,0,0.1);
      animation:fadeIn 1s ease forwards;
    }
    #resultCard h2 {
      font-size:22px;
      color:#b22222;
      margin-bottom:10px;
    }
    #resultCard p {
      margin:6px 0;
      font-size:16px;
      color:#333;
    }
    .whatsapp-btn {
      display:inline-block;
      margin-top:12px;
      padding:12px 18px;
      background:#25d366;
      color:#fff;
      font-weight:600;
      border-radius:10px;
      text-decoration:none;
      font-size:16px;
      transition:background 0.2s;
    }
    .whatsapp-btn:hover { background:#1ebc57; }
    #historyCard {
      margin-top:20px;
      padding:15px;
      border-radius:12px;
      background:#fff;
      border:2px solid #ccc;
      max-width:500px;
      margin-left:auto;
      margin-right:auto;
      text-align:left;
    }
    #historyCard h3 { margin-top:0; color:#b22222; }
    #prizesList { padding-left:20px; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üé° Ruota della Fortuna ‚Äì Impero Sushi üç£</h1>
    <div class="card">
      <canvas id="wheel" width="560" height="560"></canvas>
      <button id="spinBtn">Gira la Ruota</button>
      <div id="resultCard">
        <h2 id="resultTitle">üéâ Complimenti!</h2>
        <p id="resultText">Hai vinto: ...</p>
        <p>üç£ Impero Sushi ti ringrazia per averci scelto üíñ</p>
        <a href="https://wa.me/393XXXXXXXXX" class="whatsapp-btn">Prenota ora su WhatsApp</a>
      </div>
      <!-- Storico vincite -->
      <div id="historyCard">
        <h3>üéØ Storico vincite</h3>
        <ul id="prizesList"></ul>
      </div>
    </div>
  </div>

  <!-- Suoni -->
  <audio id="bgMusic" src="musica.mp3" preload="auto"></audio>
  <audio id="gongSound" src="gong.mp3" preload="auto"></audio>

<script>
const segments = [
  "üçù Pranzo Omaggio (Escluso bevande)","üçù Pranzo Omaggio (Escluso bevande)","üçù Pranzo Omaggio (Escluso bevande)",
  "üçù Pranzo Omaggio (Escluso bevande)","üçù Pranzo Omaggio (Escluso bevande)","üçù Pranzo Omaggio (Escluso bevande)",
  "üç∑ Cena Omaggio (Escluso bevande)","üç∑ Cena Omaggio (Escluso bevande)","üç∑ Cena Omaggio (Escluso bevande)",
  "üçπ Cocktail a scelta","üçπ Cocktail a scelta",
  "üç∞ Dolce a scelta"
];

const colors = ["#ffd700","#ff9999","#85c1ff","#b6e3a8","#f9b3d1","#ffcc99"];
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const cx = canvas.width/2, cy = canvas.height/2;
const radius = canvas.width/2 - 10;
const spinBtn = document.getElementById('spinBtn');
const resultCard = document.getElementById('resultCard');
const resultText = document.getElementById('resultText');
const bgMusic = document.getElementById('bgMusic');
const gongSound = document.getElementById('gongSound');
const prizesList = document.getElementById('prizesList');

const segAngle = (Math.PI*2)/segments.length;

function drawWheel(rotation=0) {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(rotation);
  for (let i=0;i<segments.length;i++) {
    const a1 = i*segAngle;
    const a2 = (i+1)*segAngle;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,radius,a1,a2);
    ctx.closePath();
    ctx.fillStyle = colors[i%colors.length];
    ctx.fill();
    ctx.save();
    const mid = (a1+a2)/2;
    ctx.rotate(mid);
    ctx.textAlign = "right";
    ctx.fillStyle = "#111";
    ctx.font = "16px system-ui,Arial";
    ctx.fillText(segments[i], radius - 10, 8);
    ctx.restore();
  }
  ctx.beginPath();
  ctx.arc(0,0,50,0,Math.PI*2);
  ctx.fillStyle = "#fff";
  ctx.fill();
  ctx.lineWidth = 4;
  ctx.strokeStyle = "#eee";
  ctx.stroke();
  ctx.restore();
  ctx.fillStyle = "#b22222";
  ctx.beginPath();
  ctx.moveTo(cx, 8);
  ctx.lineTo(cx-18, 46);
  ctx.lineTo(cx+18, 46);
  ctx.closePath();
  ctx.fill();
}

let spinning = false;
let spinsCount = 0;
const maxSpins = 3;
let prizesHistory = [];

function spin() {
  if (spinning) return;
  if (spinsCount >= maxSpins) {
    alert("Hai gi√† effettuato i 3 giri disponibili!");
    return;
  }
  spinsCount++;
  spinning = true;
  resultCard.style.display = "none";
  bgMusic.currentTime = 0;
  bgMusic.play();

  const targetIndex = Math.floor(Math.random()*segments.length);
  const mid = (targetIndex+0.5) * segAngle;
  const desiredRotation = (-Math.PI/2 - mid) + (Math.PI*2 * (3 + Math.floor(Math.random()*2)));
  const duration = 5000;
  const startTime = performance.now();
  function easeOutCubic(t){return 1 - Math.pow(1-t,3);}
  function frame(now) {
    const elapsed = now - startTime;
    const t = Math.min(1, elapsed / duration);
    const eased = easeOutCubic(t);
    drawWheel(desiredRotation * eased);
    if (t < 1) {
      requestAnimationFrame(frame);
    } else {
      spinning = false;
      bgMusic.pause();
      gongSound.currentTime = 0;
      gongSound.play();
      const prize = segments[targetIndex];
      resultText.innerHTML = "Hai vinto: <strong style='color:#b22222'>" + prize + "</strong>";
      resultCard.style.display = "block";
      // Aggiungi premio allo storico
      prizesHistory.push(prize);
      const li = document.createElement('li');
      li.textContent = prize;
      prizesList.appendChild(li);
      if (spinsCount >= maxSpins) {
        spinBtn.disabled = true;
        spinBtn.textContent = "Limite di 3 giri raggiunto";
      }
    }
  }
  requestAnimationFrame(frame);
}

spinBtn.addEventListener('click', spin);
drawWheel(0);
</script>
</body>
</html>
